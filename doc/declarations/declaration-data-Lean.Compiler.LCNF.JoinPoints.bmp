{"name":"Lean.Compiler.LCNF.JoinPoints","instances":[{"typeNames":["Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo"],"name":"Lean.Compiler.LCNF.JoinPointFinder.instInhabitedCandidateInfo","className":"Inhabited"}],"imports":["Init","Lean.Compiler.LCNF.CompilerM","Lean.Compiler.LCNF.PassManager","Lean.Compiler.LCNF.PullFunDecls","Lean.Compiler.LCNF.FVarUtil","Lean.Compiler.LCNF.ScopeM","Lean.Compiler.LCNF.InferType"],"declarations":[{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L629-L630","name":"Lean.Compiler.LCNF.commonJoinPointArgs","line":629,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.commonJoinPointArgs","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.commonJoinPointArgs\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">commonJoinPointArgs</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/PassManager.html#Lean.Compiler.LCNF.Pass\">Lean.Compiler.LCNF.Pass</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L626-L627","name":"Lean.Compiler.LCNF.Decl.commonJoinPointArgs","line":626,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.Decl.commonJoinPointArgs","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.Decl.commonJoinPointArgs\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">Decl</span>.<span class=\"name\">commonJoinPointArgs</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM\">Lean.Compiler.LCNF.CompilerM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L620-L621","name":"Lean.Compiler.LCNF.extendJoinPointContext","line":620,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.extendJoinPointContext","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.extendJoinPointContext\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">extendJoinPointContext</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(occurrence : <span class=\"fn\"><a href=\"./Init/Prelude.html#optParam\">optParam</a> <a href=\"./Init/Prelude.html#Nat\">Nat</a> <span class=\"fn\">0</span></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(phase : <span class=\"fn\"><a href=\"./Init/Prelude.html#optParam\">optParam</a> <a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.Phase\">Lean.Compiler.LCNF.Phase</a> <a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.Phase.mono\">Lean.Compiler.LCNF.Phase.mono</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(_h : <span class=\"fn\"><a href=\"./Init/Meta.html#autoParam\">autoParam</a> (<span class=\"fn\"><span class=\"fn\">phase</span> <a href=\"./Init/Core.html#Ne\">≠</a> <a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.Phase.base\">Lean.Compiler.LCNF.Phase.base</a></span>) <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#_auto._@.Lean.Compiler.LCNF.JoinPoints._hyg.6813\">_auto✝</a></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/PassManager.html#Lean.Compiler.LCNF.Pass\">Lean.Compiler.LCNF.Pass</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L617-L618","name":"Lean.Compiler.LCNF.Decl.extendJoinPointContext","line":617,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.Decl.extendJoinPointContext","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.Decl.extendJoinPointContext\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">Decl</span>.<span class=\"name\">extendJoinPointContext</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM\">Lean.Compiler.LCNF.CompilerM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L611-L612","name":"Lean.Compiler.LCNF.findJoinPoints","line":611,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.findJoinPoints","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.findJoinPoints\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">findJoinPoints</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/PassManager.html#Lean.Compiler.LCNF.Pass\">Lean.Compiler.LCNF.Pass</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L606-L609","name":"Lean.Compiler.LCNF.Decl.findJoinPoints","line":606,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.Decl.findJoinPoints","doc":"Find all `fun` declarations in `decl` that qualify as join points then replace\ntheir definitions and call sites with `jp`/`jmp`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.Decl.findJoinPoints\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">Decl</span>.<span class=\"name\">findJoinPoints</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM\">Lean.Compiler.LCNF.CompilerM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L561-L598","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goReduce","line":561,"kind":"opaque","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goReduce","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goReduce\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">reduce</span>.<span class=\"name\">goReduce</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(code : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceActionM\">Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceActionM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L521-L559","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goAnalyze","line":521,"kind":"opaque","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goAnalyze","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goAnalyze\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">reduce</span>.<span class=\"name\">goAnalyze</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(code : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM\">Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM</a> <a href=\"./Init/Prelude.html#Unit\">Unit</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L516-L519","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goAnalyzeFunDecl","line":516,"kind":"opaque","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goAnalyzeFunDecl","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce.goAnalyzeFunDecl\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">reduce</span>.<span class=\"name\">goAnalyzeFunDecl</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(fn : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.FunDecl\">Lean.Compiler.LCNF.FunDecl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM\">Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM</a> <a href=\"./Init/Prelude.html#Unit\">Unit</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L511-L598","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.reduce","line":511,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce","doc":"Take a look at each join point and each of their call sites. If all\ncall sites of a join point have one or more arguments in common, for example:\n```\njp _jp.1 a b c => ...\n...\ncases foo\n| n1 => jmp _jp.1 d e f\n| n2 => jmp _jp.1 g e h\n```\nWe can get rid of the common argument in favour of inlining it directly\ninto the join point (in this case the `e`). This reduces the amount of\narguments we have to pass around drastically for example in `ReaderT` based\nmonad stacks.\n\nNote 1: This transformation can in certain niche cases obtain better results.\nFor example:\n```\njp foo a b => ..\nlet x := ...\ncases discr\n| n1 => jmp foo x y\n| n2 => jmp foo x z\n```\nHere we will not collapse the `x` since it is defined after the join point `foo`\nand thus not accessible for substitution yet. We could however reorder the code in\nsuch a way that this is possible, this is currently not done since we observe\nthan in praxis most of the applications of this transformation can occur naturally\nwithout reordering.\n\nNote 2: This transformation is kind of the opposite of `JoinPointContextExtender`.\nHowever we still benefit from the extender because in the `simp` run after it\nwe might be able to pull join point declarations further up in the hierarchy\nof nested functions/join points which in turn might enable additional optimizations.\nAfter we have performed all of these optimizations we can take away the\n(remaining) common arguments and end up with nicely floated and optimized\ncode that has as little arguments as possible in the join points.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.reduce\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">reduce</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM\">Lean.Compiler.LCNF.CompilerM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L468-L469","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.isInJpScope","line":468,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.isInJpScope","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.isInJpScope\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">isInJpScope</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(jp : <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(var : <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM\">Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM</a> <a href=\"./Init/Prelude.html#Bool\">Bool</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L466-L466","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceActionM","line":466,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceActionM","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceActionM\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">ReduceActionM</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(α : <a href=\"./foundational_types.html\">Type</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L465-L465","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM","line":465,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.ReduceAnalysisM\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">ReduceAnalysisM</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(α : <a href=\"./foundational_types.html\">Type</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L463-L463","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState.jpJmpArgs","line":463,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState.jpJmpArgs","doc":"A map, that for each join point id contains a map from all (so far)\nduplicated argument ids to the respective duplicate value\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState.jpJmpArgs\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">AnalysisState</span>.<span class=\"name\">jpJmpArgs</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState\">Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Expr.html#Lean.FVarIdMap\">Lean.FVarIdMap</a> <a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.FVarSubst\">Lean.Compiler.LCNF.FVarSubst</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L458-L463","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState","line":458,"kind":"structure","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState","doc":"State for `ReduceAnalysisM`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">AnalysisState</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L453-L453","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx.jpScopes","line":453,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx.jpScopes","doc":"The variables that are in scope at the time of the definition of\nthe join point.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx.jpScopes\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">AnalysisCtx</span>.<span class=\"name\">jpScopes</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx\">Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Expr.html#Lean.FVarIdMap\">Lean.FVarIdMap</a> <a href=\"./Lean/Expr.html#Lean.FVarIdSet\">Lean.FVarIdSet</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L448-L453","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx","line":448,"kind":"structure","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx","doc":"Context for `ReduceAnalysisM`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">AnalysisCtx</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L398-L439","name":"Lean.Compiler.LCNF.JoinPointContextExtender.extend.go","line":398,"kind":"opaque","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extend.go","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extend.go\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">extend</span>.<span class=\"name\">go</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(code : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L395-L397","name":"Lean.Compiler.LCNF.JoinPointContextExtender.extend.goFVar","line":395,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extend.goFVar","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extend.goFVar\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">extend</span>.<span class=\"name\">goFVar</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(fvar : <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L390-L439","name":"Lean.Compiler.LCNF.JoinPointContextExtender.extend","line":390,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extend","doc":"Use all of the above functions to find free variables declared outside\nof join points that said join points can be reasonaly extended by. Reasonable\nmeaning that in case the current join point is nested within a function\ndeclaration we will not extend it by free variables declared before the\nfunction declaration because we cannot lift join points outside of function\ndeclarations.\n\nAll of this is done to eliminate dependencies of join points onto their\nposition within the code so we can pull them out as far as possible, hopefully\nenabling new inlining possibilities in the next simplifier run.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extend\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">extend</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM\">Lean.Compiler.LCNF.CompilerM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L373-L376","name":"Lean.Compiler.LCNF.JoinPointContextExtender.withNewAltScope","line":373,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewAltScope","doc":"We call this whenever we visit a new arm of a cases statement.\nIt will back up the current scope (since we are doing a case split\nand want to continue with other arms afterwards) and add all of the\nparameters of the match arm to the list of candidates.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewAltScope\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">withNewAltScope</span></a></span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">{α : <a href=\"./foundational_types.html\">Type</a>}</span></span>\n</span><span class=\"decl_args\">\n<span class=\"fn\">(alt : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Alt\">Lean.Compiler.LCNF.Alt</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L360-L365","name":"Lean.Compiler.LCNF.JoinPointContextExtender.withNewJpScope","line":360,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewJpScope","doc":"We call this whenever we enter a new join point. It will set the current\njoin point and extend the list of candidates by all of the parameters of\nthe join point. This is so in the case of nested join points that refer\nto parameters of the current one we extend the context of the nested\njoin points by said parameters.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewJpScope\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">withNewJpScope</span></a></span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">{α : <a href=\"./foundational_types.html\">Type</a>}</span></span>\n</span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.FunDecl\">Lean.Compiler.LCNF.FunDecl</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L348-L351","name":"Lean.Compiler.LCNF.JoinPointContextExtender.withNewFunScope","line":348,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewFunScope","doc":"We call this whenever we enter a new local function. It clears both the\ncurrent join point and the list of candidates since we cant lift join\npoints outside of functions as explained in `mergeJpContextIfNecessary`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewFunScope\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">withNewFunScope</span></a></span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">{α : <a href=\"./foundational_types.html\">Type</a>}</span></span>\n</span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.FunDecl\">Lean.Compiler.LCNF.FunDecl</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L337-L341","name":"Lean.Compiler.LCNF.JoinPointContextExtender.mergeJpContextIfNecessary","line":337,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.mergeJpContextIfNecessary","doc":"Merge the extended context of two join points if necessary. That is\nif we have a structure such as:\n```\njp j.1 ... =>\n  jp j.2 .. =>\n    ...\n  ...\n```\nAnd we are just done visiting `j.2` we want to extend the context of\n`j.1` by all free variables that the context of `j.2` was extended by\nas well because we need to drag these variables through at the call sites\nof `j.2` in `j.1`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.mergeJpContextIfNecessary\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">mergeJpContextIfNecessary</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(jp : <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <a href=\"./Init/Prelude.html#Unit\">Unit</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L313-L321","name":"Lean.Compiler.LCNF.JoinPointContextExtender.extendByIfNecessary","line":313,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extendByIfNecessary","doc":"Extend the context of the current join point (if we are within one)\nby `fvar` if necessary.\nThis is necessary if:\n- `fvar` is not in scope (that is, was declared outside of the current jp)\n- we have not already extended the context by `fvar`\n- the list of candidates contains `fvar`. This is because if we have something\n  like:\n  ```\n  let x := ..\n  fun f a =>\n    jp j b =>\n      let y := x\n      y\n  ```\n  There is no point in extending the context of `j` by `x` because we\n  cannot lift a join point outside of a local function declaration.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.extendByIfNecessary\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">extendByIfNecessary</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(fvar : <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <a href=\"./Init/Prelude.html#Unit\">Unit</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L283-L293","name":"Lean.Compiler.LCNF.JoinPointContextExtender.withNewCandidates","line":283,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewCandidates","doc":"Same as `withNewCandidate` but with multiple `FVarId`s.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewCandidates\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">withNewCandidates</span></a></span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">{α : <a href=\"./foundational_types.html\">Type</a>}</span></span>\n</span><span class=\"decl_args\">\n<span class=\"fn\">(fvars : <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L272-L278","name":"Lean.Compiler.LCNF.JoinPointContextExtender.withNewCandidate","line":272,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewCandidate","doc":"Add a new candidate to the current scope + to the list of candidates\nif we are currently within a join point. Then execute `x`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.withNewCandidate\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">withNewCandidate</span></a></span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">{α : <a href=\"./foundational_types.html\">Type</a>}</span></span>\n</span><span class=\"decl_args\">\n<span class=\"fn\">(fvar : <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <span class=\"fn\">α</span></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L261-L266","name":"Lean.Compiler.LCNF.JoinPointContextExtender.replaceFVar","line":261,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.replaceFVar","doc":"Replace a free variable if necessary, that is:\n- It is in the list of candidates\n- We are currently within a join point (if we are within a function there\n  cannot be a need to replace them since we dont extend their context)\n- Said join point actually has a replacement parameter registered.\notherwise just return `fvar`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.replaceFVar\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">replaceFVar</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(fvar : <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L251-L251","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM","line":251,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM","doc":"The monad for the `extendJoinPointContext` pass.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendM\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendM</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(α : <a href=\"./foundational_types.html\">Type</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L246-L246","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState.fvarMap","line":246,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState.fvarMap","doc":"A map from join point `FVarId`s to a respective map from free variables\nto `Param`s. The free variables in this map are the once that the context\nof said join point will be extended by by passing in the respective parameter.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState.fvarMap\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendState</span>.<span class=\"name\">fvarMap</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Data/HashMap.html#Lean.HashMap\">Lean.HashMap</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a> (<span class=\"fn\"><a href=\"./Lean/Data/HashMap.html#Lean.HashMap\">Lean.HashMap</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Param\">Lean.Compiler.LCNF.Param</a></span>)</span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L240-L246","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState","line":240,"kind":"structure","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState","doc":"The state managed by `ExtendM`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendState</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L235-L235","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.candidates","line":235,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.candidates","doc":"The list of valid candidates for extending the context. This will be\nall `let` and `fun` declarations as well as all `jp` parameters up\nuntil the last `fun` declaration in the tree.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.candidates\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendContext</span>.<span class=\"name\">candidates</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Expr.html#Lean.FVarIdSet\">Lean.FVarIdSet</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L229-L229","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.currentJp?","line":229,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.currentJp?","doc":"The `FVarId` of the current join point if we are currently inside one.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.currentJp?\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendContext</span>.<span class=\"name\">currentJp?</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Option\">Option</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L225-L235","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext","line":225,"kind":"structure","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext","doc":"The context managed by `ExtendM`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendContext</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L183-L214","name":"Lean.Compiler.LCNF.JoinPointFinder.replace.go","line":183,"kind":"opaque","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.replace.go","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.replace.go\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">replace</span>.<span class=\"name\">go</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(code : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.ReplaceM\">Lean.Compiler.LCNF.JoinPointFinder.ReplaceM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L177-L214","name":"Lean.Compiler.LCNF.JoinPointFinder.replace","line":177,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.replace","doc":"Replace all join point candidate `fun` declarations with `jp` ones\nand all calls to them with `jmp`s.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.replace\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">replace</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(state : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState\">Lean.Compiler.LCNF.JoinPointFinder.FindState</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM\">Lean.Compiler.LCNF.CompilerM</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L138-L171","name":"Lean.Compiler.LCNF.JoinPointFinder.find.go","line":138,"kind":"opaque","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.find.go","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.find.go\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">find</span>.<span class=\"name\">go</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Code\">Lean.Compiler.LCNF.Code</a> → <span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindM\">Lean.Compiler.LCNF.JoinPointFinder.FindM</a> <a href=\"./Init/Prelude.html#Unit\">Unit</a></span></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L134-L171","name":"Lean.Compiler.LCNF.JoinPointFinder.find","line":134,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.find","doc":"Find all `fun` declarations that qualify as a join point, that is:\n- are always fully applied\n- are always called in tail position\n\nWhere a `fun` `f` is in tail position iff it is called as follows:\n```\nlet res := f arg\nres\n```\nThe majority (if not all) tail calls will be brought into this form\nby the simplifier pass.\n\nFurthermore a `fun` disqualifies as a join point if turning it into a join\npoint would turn a call to it into an out of scope join point.\nThis can happen if we have something like:\n```\ndef test (b : Bool) (x y : Nat) : Nat :=\n  fun myjp x => Nat.add x (Nat.add x x)\n  fun f y =>\n    let x := Nat.add y y\n    myjp x\n  fun f y =>\n    let x := Nat.mul y y\n    myjp x\n  cases b (f x) (g y)\n```\n`f` and `g` can be detected as a join point right away, however\n`myjp` can only ever be detected as a join point after we have established\nthis. This is because otherwise the calls to `myjp` in `f` and `g` would\nproduce out of scope join point jumps.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.find\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">find</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(decl : <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Decl\">Lean.Compiler.LCNF.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.CompilerM\">Lean.Compiler.LCNF.CompilerM</a> <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState\">Lean.Compiler.LCNF.JoinPointFinder.FindState</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L51-L51","name":"Lean.Compiler.LCNF.JoinPointFinder.ReplaceM","line":51,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.ReplaceM","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.ReplaceM\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">ReplaceM</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(α : <a href=\"./foundational_types.html\">Type</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L50-L50","name":"Lean.Compiler.LCNF.JoinPointFinder.FindM","line":50,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindM","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindM\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">FindM</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(α : <a href=\"./foundational_types.html\">Type</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L48-L48","name":"Lean.Compiler.LCNF.JoinPointFinder.ReplaceCtx","line":48,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.ReplaceCtx","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.ReplaceCtx\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">ReplaceCtx</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L46-L46","name":"Lean.Compiler.LCNF.JoinPointFinder.FindState.scope","line":46,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState.scope","doc":"The `FVarId`s of all `fun` declarations that were declared within the\ncurrent `fun`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState.scope\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">FindState</span>.<span class=\"name\">scope</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState\">Lean.Compiler.LCNF.JoinPointFinder.FindState</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Data/HashSet.html#Lean.HashSet\">Lean.HashSet</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L41-L41","name":"Lean.Compiler.LCNF.JoinPointFinder.FindState.candidates","line":41,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState.candidates","doc":"All current join point candidates accessible by their `FVarId`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState.candidates\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">FindState</span>.<span class=\"name\">candidates</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState\">Lean.Compiler.LCNF.JoinPointFinder.FindState</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Data/HashMap.html#Lean.HashMap\">Lean.HashMap</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a> <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo\">Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L37-L46","name":"Lean.Compiler.LCNF.JoinPointFinder.FindState","line":37,"kind":"structure","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState","doc":"The state for the join point candidate finder.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">FindState</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L32-L32","name":"Lean.Compiler.LCNF.JoinPointFinder.instInhabitedCandidateInfo","line":32,"kind":"instance","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.instInhabitedCandidateInfo","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">instance</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.instInhabitedCandidateInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">instInhabitedCandidateInfo</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Inhabited\">Inhabited</a> <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo\">Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L31-L31","name":"Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.associated","line":31,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.associated","doc":"The set of candidates that rely on this candidate to be a join point.\nFor a more detailed explanation see the documentation of `find`\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.associated\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">CandidateInfo</span>.<span class=\"name\">associated</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo\">Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Data/HashSet.html#Lean.HashSet\">Lean.HashSet</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L26-L26","name":"Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.arity","line":26,"kind":"def","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.arity","doc":"The arity of the candidate\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.arity\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">CandidateInfo</span>.<span class=\"name\">arity</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo\">Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Init/Prelude.html#Nat\">Nat</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L22-L32","name":"Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo","line":22,"kind":"structure","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo","doc":"Info about a join point candidate (a `fun` declaration) during the find phase.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">CandidateInfo</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L1-L1","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState.mk","line":1,"kind":"ctor","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState.mk","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendState</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(fvarMap : <span class=\"fn\"><a href=\"./Lean/Data/HashMap.html#Lean.HashMap\">Lean.HashMap</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a> (<span class=\"fn\"><a href=\"./Lean/Data/HashMap.html#Lean.HashMap\">Lean.HashMap</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a> <a href=\"./Lean/Compiler/LCNF/Basic.html#Lean.Compiler.LCNF.Param\">Lean.Compiler.LCNF.Param</a></span>)</span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendState</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L1-L1","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState.mk","line":1,"kind":"ctor","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState.mk","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">AnalysisState</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(jpJmpArgs : <span class=\"fn\"><a href=\"./Lean/Expr.html#Lean.FVarIdMap\">Lean.FVarIdMap</a> <a href=\"./Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.FVarSubst\">Lean.Compiler.LCNF.FVarSubst</a></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState\">Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisState</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L1-L1","name":"Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.mk","line":1,"kind":"ctor","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.mk","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointContextExtender</span>.<span class=\"name\">ExtendContext</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(currentJp? : <span class=\"fn\"><a href=\"./Init/Prelude.html#Option\">Option</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(candidates : <a href=\"./Lean/Expr.html#Lean.FVarIdSet\">Lean.FVarIdSet</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext\">Lean.Compiler.LCNF.JoinPointContextExtender.ExtendContext</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L1-L1","name":"Lean.Compiler.LCNF.JoinPointFinder.FindState.mk","line":1,"kind":"ctor","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState.mk","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">FindState</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(candidates : <span class=\"fn\"><a href=\"./Lean/Data/HashMap.html#Lean.HashMap\">Lean.HashMap</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a> <a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo\">Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(scope : <span class=\"fn\"><a href=\"./Lean/Data/HashSet.html#Lean.HashSet\">Lean.HashSet</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.FindState\">Lean.Compiler.LCNF.JoinPointFinder.FindState</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L1-L1","name":"Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.mk","line":1,"kind":"ctor","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.mk","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointFinder</span>.<span class=\"name\">CandidateInfo</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(arity : <a href=\"./Init/Prelude.html#Nat\">Nat</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(associated : <span class=\"fn\"><a href=\"./Lean/Data/HashSet.html#Lean.HashSet\">Lean.HashSet</a> <a href=\"./Lean/Expr.html#Lean.FVarId\">Lean.FVarId</a></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo\">Lean.Compiler.LCNF.JoinPointFinder.CandidateInfo</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/a62d2fd4979671b76b8ab13ccbe4fdf410ec0d9d/src/Lean/Compiler/LCNF/JoinPoints.lean#L1-L1","name":"Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx.mk","line":1,"kind":"ctor","docLink":"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx.mk","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Compiler</span>.<span class=\"name\">LCNF</span>.<span class=\"name\">JoinPointCommonArgs</span>.<span class=\"name\">AnalysisCtx</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(jpScopes : <span class=\"fn\"><a href=\"./Lean/Expr.html#Lean.FVarIdMap\">Lean.FVarIdMap</a> <a href=\"./Lean/Expr.html#Lean.FVarIdSet\">Lean.FVarIdSet</a></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/LCNF/JoinPoints.html#Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx\">Lean.Compiler.LCNF.JoinPointCommonArgs.AnalysisCtx</a></div></div>"}]}